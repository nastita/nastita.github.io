---
const menuItems = [
  { name: 'Main', href: '#main' },
  { name: 'Exp', href: '#exp' },
  { name: 'Skills', href: '#skills' },
  { name: 'Kudos', href: '#kudos' },
];
---

<header
  id='header'
  class='fixed top-0 left-0 w-full z-[100] flex justify-center items-start pointer-events-none'
>
  <div id='nav-container' class='relative z-[110] w-full flex justify-center'>
    <div class='w-full flex flex-col items-center'>
      <div
        id='nav-overlay'
        class='absolute left-1/2 -translate-x-1/2 top-0 w-[24rem] max-w-[90vw] bg-base-200 rounded-2xl shadow-lg z-[115] origin-top flex justify-center pointer-events-auto'
        style='margin-top:1.2rem;'
      >
        <nav
          id='nav-menu'
          class='flex flex-row justify-center items-center gap-8 px-6 py-4 w-full'
        >
          {
            menuItems.map((item, idx) => (
              <a
                href={item.href}
                class={`menu-item uppercase text-2xl font-monument tracking-tight nav-link hover:text-accent text-neutral-content relative`}
                style='font-family: PPMonumentExtended-Regular, SpaceMono, monospace;'
                data-menu-index={idx}
              >
                {item.name}
                <span
                  class='menu-dot absolute left-1/2 -translate-x-1/2 mt-0 block'
                  style={`font-size:1.1rem; opacity:0; transition:opacity 0.2s; top:90%;`}
                >
                  â€¢
                </span>
              </a>
            ))
          }
        </nav>
      </div>
    </div>
  </div>
</header>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const header = document.getElementById('header');

  let lastScrollTop = 0;

  // Hide header almost completely, but leave a small part visible
  const headerHideY = -56; // px, lower so dot is visible when hidden
  ScrollTrigger.create({
    id: 'header-scroll',
    start: 'top top',
    end: '+=9999',
    onUpdate: (self) => {
      const scrollTop =
        window.pageYOffset || document.documentElement.scrollTop;

      if (scrollTop > lastScrollTop && scrollTop > 100) {
        // Scrolling down & past threshold
        gsap.to(header, {
          y: headerHideY,
          duration: 0.3,
          ease: 'linear',
          overwrite: 'auto',
        });
      } else {
        // Scrolling up or at top
        gsap.to(header, {
          y: 0,
          duration: 0.3,
          ease: 'linear',
          overwrite: 'auto',
        });
      }

      lastScrollTop = scrollTop;
    },
  });

  // Active menu dot logic
  // Use Astro menuItems directly
  const sectionIds = ['main', 'exp', 'skills', 'kudos'];
  const navLinks = document.querySelectorAll('.nav-link');
  const menuDots = document.querySelectorAll('.menu-dot');

  function updateActiveMenu() {
    let activeIdx = 0;
    for (let i = 0; i < sectionIds.length; i++) {
      const section = document.getElementById(sectionIds[i]);
      if (section) {
        const rect = section.getBoundingClientRect();
        if (rect.top <= 120 && rect.bottom > 120) {
          activeIdx = i;
          break;
        }
      }
    }
    navLinks.forEach((link, idx) => {
      if (menuDots[idx] instanceof HTMLElement) {
        // Only show dot for active menu item
        (menuDots[idx] as HTMLElement).style.opacity =
          idx === activeIdx ? '1' : '0';
      }
      if (idx === activeIdx) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  }

  window.addEventListener('scroll', updateActiveMenu);
  window.addEventListener('resize', updateActiveMenu);
  document.addEventListener('DOMContentLoaded', updateActiveMenu);

  // const navOverlay = document.getElementById('nav-overlay');
  // const navMenu = document.getElementById('nav-menu');
</script>
