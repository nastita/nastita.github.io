---
import content from '../../content.json';

const menuItems = [
  { name: 'Main', href: '#main' },
  { name: 'Exp', href: '#exp' },
  { name: 'Skills', href: '#skills' },
  { name: 'Kudos', href: '#kudos' },
];

const socialLinks = [
  { 
    name: 'GitHub', 
    url: content.contact.github, 
    icon: '/icons/github.svg',
    ariaLabel: 'GitHub Profile'
  },
  { 
    name: 'LinkedIn', 
    url: content.contact.linkedin, 
    icon: '/icons/linkedin.svg',
    ariaLabel: 'LinkedIn Profile'
  },
  { 
    name: 'Resume', 
    url: content.contact.resume, 
    icon: '/icons/resume.svg',
    ariaLabel: 'Download Resume',
    download: true
  }
];
---

<!-- Top progress bar -->
<div
  class='fixed top-0 left-0 w-full h-1 bg-transparent z-[200] pointer-events-none'
>
  <div
    id='progress-bar'
    class='h-full bg-primary transition-all duration-100 ease-out'
    style='width: 0%;'
  >
  </div>
</div>

<header
  id='header'
  class='fixed top-0 right-0 w-full z-[100] flex justify-center pointer-events-none'
>
  <!-- Small screen dropdown button (below 640px) -->
  <div class='sm:hidden fixed top-5 left-5 z-[110] pointer-events-auto'>
    <div class='dropdown dropdown-start'>
      <div
        tabindex='0'
        role='button'
        class='btn btn-circle btn-ghost bg-base-200 shadow-lg'
      >
        <svg
          xmlns='http://www.w3.org/2000/svg'
          class='h-5 w-5'
          fill='none'
          viewBox='0 0 24 24'
          stroke='currentColor'
        >
          <path
            stroke-linecap='round'
            stroke-linejoin='round'
            stroke-width='2'
            d='M4 6h16M4 12h8m-8 6h16'></path>
        </svg>
      </div>
      <ul
        tabindex='0'
        class='menu dropdown-content bg-base-200 rounded-box z-[1] mt-3 w-52 p-2 shadow'
      >
        {
          menuItems.map((item, idx) => (
            <li>
              <a
                href={item.href}
                class='menu-item text-base uppercase nav-link hover:text-primary text-neutral-content'
                data-menu-index={idx}
              >
                {item.name}
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </div>

  <!-- Pill navbar for 640px and above -->
  <div
    class='hidden sm:flex bg-base-200 rounded-2xl shadow-lg pointer-events-auto min-w-fit'
    style='margin-top:1.2rem;'
  >
    <ul class='menu menu-horizontal px-2'>
      {
        menuItems.map((item, idx) => (
          <li>
            <a
              href={item.href}
              class='menu-item text-base uppercase nav-link hover:text-primary text-neutral-content hover:scale-105 transition-transform duration-200'
              data-menu-index={idx}
            >
              {item.name}
            </a>
          </li>
        ))
      }
    </ul>

    <ul class='menu menu-horizontal border-l border-base-content/20 px-2'>
      {
        socialLinks.map((social) => (
          <li>
            <a
              href={social.url}
              target='_blank'
              rel='noopener noreferrer'
              class='text-white hover:text-primary transition-all duration-200 hover:scale-105 tooltip tooltip-bottom tooltip-primary'
              aria-label={social.ariaLabel}
              data-tip={social.ariaLabel}
              download={social.download}
            >
              <img
                src={social.icon}
                alt={social.name}
                class='h-6 w-6 flex-shrink-0 brightness-0 invert'
              />
            </a>
          </li>
        ))
      }
    </ul>
  </div>

  <!-- Social links for small screens - always visible -->
  <div class='sm:hidden fixed top-5 right-5 z-[110] pointer-events-auto flex gap-2'>
    {
      socialLinks.map((social) => (
        <a
          href={social.url}
          target='_blank'
          rel='noopener noreferrer'
          class='btn btn-circle btn-ghost bg-base-200 shadow-lg text-white hover:text-primary transition-all duration-200'
          aria-label={social.ariaLabel}
          download={social.download}
        >
          <img
            src={social.icon}
            alt={social.name}
            class='h-5 w-5 flex-shrink-0 brightness-0 invert'
          />
        </a>
      ))
    }
  </div>

    <script>
      import gsap from 'gsap';
      import { ScrollTrigger } from 'gsap/ScrollTrigger';

      gsap.registerPlugin(ScrollTrigger);

      // Progress bar scroll indicator
      const sectionIds = ['main', 'exp', 'skills', 'kudos'];
      const navLinks = document.querySelectorAll('.nav-link');
      const progressBar = document.getElementById('progress-bar');

      if (progressBar) {
        // Create ScrollTrigger for overall page progress
        ScrollTrigger.create({
          trigger: 'body',
          start: 'top top',
          end: 'bottom bottom',
          onUpdate: (self) => {
            // Calculate overall scroll progress (0 to 1)
            const scrollProgress = self.progress;

            // Update progress bar width
            gsap.set(progressBar, {
              width: `${scrollProgress * 100}%`,
            });

            // Also determine current active section for menu highlighting
            let currentSection = 0;

            for (let i = 0; i < sectionIds.length; i++) {
              const section = document.getElementById(sectionIds[i]);
              if (section) {
                const rect = section.getBoundingClientRect();
                // Section is active if it's prominently in the viewport (top portion)
                if (rect.top <= 200 && rect.bottom > 200) {
                  currentSection = i;
                  break;
                }
              }
            }

            // Update active link states
            navLinks.forEach((link, idx) => {
              if (idx === currentSection) {
                link.classList.add('active');
              } else {
                link.classList.remove('active');
              }
            });
          },
        });
      }
    </script>
  </div>
</header>
